# v3.4.0

#### New

* [RPC supports signed Call interface](https://github.com/FISCO-BCOS/FISCO-BCOS/pull/3611)
* [P2P dynamic loading black and white list](https://github.com/FISCO-BCOS/FISCO-BCOS/pull/3621)

#### Modify

* [Upgrade TBB version to 2021.8.0](https://github.com/FISCO-BCOS/FISCO-BCOS/pull/3656)
* [Optimize the mutex range of read-write locks in synchronization scenarios](https://github.com/FISCO-BCOS/FISCO-BCOS/pull/3650)

#### Repair

* [Fix bug of occasional synchronization failure in extreme scenarios](https://github.com/FISCO-BCOS/FISCO-BCOS/pull/3674)
* [Fix bug that only part of the contract is rolled back when the transaction is rolled back](https://github.com/FISCO-BCOS/FISCO-BCOS/pull/3629)
* [Fix bug of return value processing in mark transaction operation when viewchange](https://github.com/FISCO-BCOS/FISCO-BCOS/pull/3654)
* [Fix the bug that the occasional proxy in the disconnection scenario under pro architecture is empty](https://github.com/FISCO-BCOS/FISCO-BCOS/pull/3684)
* [Fix bug of AMOP callback destructor](https://github.com/FISCO-BCOS/FISCO-BCOS/pull/3673)
* [Fix thread safety issues in BucketMap extreme cases](https://github.com/FISCO-BCOS/FISCO-BCOS/pull/3666)
* [Fix the problem of repeatedly creating multiple task _ groups in Session](https://github.com/FISCO-BCOS/FISCO-BCOS/pull/3662)
* [Fix the bug that Response is empty due to coding problems when light nodes send transactions](https://github.com/FISCO-BCOS/FISCO-BCOS/pull/3670)
* [Fix the fatal that KeyPage may trigger after deleting data in an empty table](https://github.com/FISCO-BCOS/FISCO-BCOS/pull/3686)

* Historical Version Upgrade

  The "data compatibility version number ([compatibility _ version] of the chain that needs to be upgraded"(#id5)) "is the following version.

  * 3.4.x: The data is fully compatible with the current version, and the upgrade can be completed by directly replacing the binary
  * 3.3.x, 3.2.x, 3.1.x, 3.0.x: supports gray-scale upgrade by replacing the binary. If you need to use the new features of the current version, you need to upgrade the data compatible version number. See [Document](#id5)
  * 3.0-rc x: The data is incompatible and cannot be upgraded. You can consider gradually migrating your business to the 3.x official version.
  * 2.x: data is not compatible, 2.x version is still maintained, you can consider upgrading to the latest version of 2.x

**Component compatibility**

|            | Recommended Version| Minimum Version| Description|
| ---------- | --------- | ------------------------ | ---------------------------------- |
| WeBASE     | 3.0.2      | 3.0.2                   |                                    |
| WeIdentity | v3.0.0-rc.1| v3.0.0-rc.1             |                                    |
| Console    | 3.4.0     | 3.0.0                    |                                    |
| Java SDK   | 3.4.0     | 3.0.0                    |                                    |
| CPP SDK    | 3.4.0     | 3.0.0                    |                                    |
| Solidity   | 0.8.11    | Minimum 0.4.25, maximum 0.8.11| The compiler (console) needs to be downloaded according to the contract version|
| WBC-Liquid | 1.0.0-rc3 | 1.0.0-rc3                |                                    |

#### Upgrade Method

This operation only supports upgrading version 3.x to this version, not 3.0-Upgrade of rc or 2.x。

##### Query data compatibility version number (compatibility _ version)

Use [console](https://fisco-bcos-doc.readthedocs.io/zh_CN/latest/docs/operation_and_maintenance/console/console_commands.html#getsystemconfigbykey)Query, such as the current version returned is 3.0.0

``` 
[group0]: /apps>  getSystemConfigByKey compatibility_version
3.0.0
```

##### Replace Node Binary

Need to be**All Nodes**Gradually replace the binary with the current version。In order not to affect the business, the replacement process can be done in grayscale, replacing and restarting nodes one by one。During the replacement process, the current chain continues to execute with the logic of the old data-compatible version number.。After the binary replacement of all nodes is completed and restarted, you need to use the console to modify the data compatibility version number to the current version。

##### Set the data compatibility version number (compatibility _ version)

Use [console](https://fisco-bcos-doc.readthedocs.io/zh_CN/latest/docs/operation_and_maintenance/console/console_commands.html#setsystemconfigbykey)Set the data compatibility version number. For example, the current version is 3.4.0.。

```
[group0]: /apps>  setSystemConfigByKey compatibility_version 3.4.0
{
    "code":0,
    "msg":"success"
}

Note: If the permission governance function is enabled, you need to use the setSysConfigProposal command
```

Set successfully, query again, the current version has been upgraded to 3.4.0

``` 
[group0]: /apps>  getSystemConfigByKey compatibility_version
3.4.0
```

The current chain has been upgraded, so far,**The chain continues to run with new logic**and supports new features。
