# v3.5.0

#### New

* [Add rPBFT consensus algorithm](https://github.com/FISCO-BCOS/FISCO-BCOS/pull/3602)
* [support transaction synchronization, block synchronization tree broadcast](https://github.com/FISCO-BCOS/FISCO-BCOS/pull/3630,)
* [Added Paillier Precompiled Contract](https://github.com/FISCO-BCOS/FISCO-BCOS/pull/3757)
* [support sending transaction with tars rpc protocol](https://github.com/FISCO-BCOS/FISCO-BCOS/pull/3718)

#### Modify

* [Log Print Optimization](https://github.com/FISCO-BCOS/FISCO-BCOS/pull/3845)

#### Repair

* [Fix bug of wrong transaction volume of transaction pool notification packaging module](https://github.com/FISCO-BCOS/FISCO-BCOS/pull/3715)
* [Fixed Consensus Module Proposal Validation Vulnerability and CheckPoint Timer Timing Issue](https://github.com/FISCO-BCOS/FISCO-BCOS/pull/3759)
* [Fix the problem of backlog of transactions in the transaction pool caused by the failure of Proposal verification in the consensus module and the improper handling of transactions](https://github.com/FISCO-BCOS/FISCO-BCOS/pull/3809)
* [Fix the problem that the call with sign interface fails to be verified in the national secret node of Pro architecture](https://github.com/FISCO-BCOS/FISCO-BCOS/pull/3797)
* [Fix code coverage statistics exception](https://github.com/FISCO-BCOS/FISCO-BCOS/pull/3777)
* [Fix issue with self-locking during DAG execution](https://github.com/FISCO-BCOS/FISCO-BCOS/pull/3831)
* [Synchronize bugs fixed by 3.2.x](https://github.com/FISCO-BCOS/FISCO-BCOS/pull/3899)
* [Fix evm cache invalidation issue](https://github.com/FISCO-BCOS/FISCO-BCOS/pull/3854)
* [Fix an issue with gateway sending corrupted message packets](https://github.com/FISCO-BCOS/FISCO-BCOS/pull/3825)
* [Fix processing of abi fields during archive tool re-import](https://github.com/FISCO-BCOS/FISCO-BCOS/pull/3820)
* [Fix handling of nonce field during archive tool re-import](https://github.com/FISCO-BCOS/FISCO-BCOS/pull/3811)
* [build _ chain.sh build chain script-l parameter supports resolving domain names](https://github.com/FISCO-BCOS/FISCO-BCOS/pull/3931)
* [Fix boost log deadlock caused by node receiving USR1 / USR2 signal](https://github.com/FISCO-BCOS/FISCO-BCOS/pull/3947)
* [Fix the problem of blocking rpc requests when taking Merkel certificates](https://github.com/FISCO-BCOS/FISCO-BCOS/pull/3955)


* Historical Version Upgrade

  The "data compatibility version number ([compatibility _ version] of the chain that needs to be upgraded"(#id5)) "is the following version.

  * 3.4.x, 3.5.x: The data is fully compatible with the current version, and the upgrade can be completed by directly replacing the binary
  * 3.3.x, 3.2.x, 3.1.x, 3.0.x: supports gray-scale upgrade by replacing the binary. If you need to use the new features of the current version, you need to upgrade the data compatible version number. See [Document](#id5)
  * 3.0-rc x: The data is incompatible and cannot be upgraded. You can consider gradually migrating your business to the 3.x official version.
  * 2.x: data is not compatible, 2.x version is still maintained, you can consider upgrading to the latest version of 2.x


* Turn on the experiment function

  Effect: The opening of the experimental function is controlled by the feature switch

  Operation: After the node executable is upgraded, use the console command 'setSystemConfigByKey < feature name > 1' to enable the corresponding experimental function. For more information, see Upgrade Methods in the documentation.

  Note:
  * feature operation is irreversible and cannot be closed after opening
  * After confirming that all executable programs have the same version, open the feature

|         | Feature Name| Default State| Description|
|---------|---------------------|------|--------------------------------------------|
| intra-block fragmentation| feature_sharding    | Off: 0| By default, feature _ sharding is turned on only when upgrading from 3.3 or 3.4 to the current version|
| homomorphic encryption| feature_paillier    | Off: 0| Default Off|
| rpbft consensus| feature_rpbft       | Off: 0| Default Off|
| Bug fixes| bugfix_\<bug_name\> | On: 1| Upgrading from a lower version is off by default|

**Component compatibility**

|            | Recommended Version| Minimum Version| Description|
|------------|-------------|---------------------|-------------------|
| WeBASE     | 3.0.2       | 3.0.2               |                   |
| WeIdentity | v3.0.0-rc.1 | v3.0.0-rc.1         |                   |
| Console    | 3.5.0       | 3.0.0               |                   |
| Java SDK   | 3.5.0       | 3.0.0               |                   |
| CPP SDK    | 3.5.0       | 3.0.0               |                   |
| Solidity   | 0.8.11      | Minimum 0.4.25, maximum 0.8.11| The compiler (console) needs to be downloaded according to the contract version|
| WBC-Liquid | 1.0.0-rc3   | 1.0.0-rc3           |                   |

#### Upgrade Method

This operation only supports upgrading version 3.x to this version, not 3.0-Upgrade of rc or 2.x。

##### Query data compatibility version number (compatibility _ version)

Use [console](https://fisco-bcos-doc.readthedocs.io/zh_CN/latest/docs/operation_and_maintenance/console/console_commands.html#getsystemconfigbykey)
Query, such as the current version returned is 3.0.0

``` 
[group0]: /apps>  getSystemConfigByKey compatibility_version
3.0.0
```

##### Replace Node Binary

Need to be**All Nodes**
Gradually replace the binary with the current version。In order not to affect the business, the replacement process can be done in grayscale, replacing and restarting nodes one by one。During the replacement process, the current chain continues to execute with the logic of the old data-compatible version number.。After the binary replacement of all nodes is completed and restarted, you need to use the console to modify the data compatibility version number to the current version。

##### Set the data compatibility version number (compatibility _ version)

Use [console](https://fisco-bcos-doc.readthedocs.io/zh_CN/latest/docs/operation_and_maintenance/console/console_commands.html#setsystemconfigbykey)
Set the data compatibility version number. For example, the current version is 3.5.0.。

```
[group0]: /apps>  setSystemConfigByKey compatibility_version 3.5.0
{
    "code":0,
    "msg":"success"
}

Note: If the permission governance function is enabled, you need to use the setSysConfigProposal command
```

Set successfully, query again, the current version has been upgraded to 3.5.0

``` 
[group0]: /apps>  getSystemConfigByKey compatibility_version
3.5.0
```

The current chain has been upgraded, so far,**The chain continues to run with new logic**and supports new features。

##### Enable rpbft consensus through feature switch

Run the getSystemConfigByKey command in the console to view the feature status of the current rpbft

```
[group0]: /apps> getSystemConfigByKey feature_rpbft
0
```

Use the setSystemConfigByKey command to enable the rpbft feature and enable rpbft consensus.

```
[group0]: /apps> setSystemConfigByKey feature_rpbft 1
{
    "code":0,
    "msg":"success"
}
```

Run the getSystemConfigByKey command in the console to check whether the feature of the current rpbft is enabled. A value of 1 indicates that the feature is enabled.

```
[group0]: /apps> getSystemConfigByKey feature_rpbft
1
```